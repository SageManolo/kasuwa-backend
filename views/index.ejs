<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<style>

html {
  font-size: 1rem;
}
th{
  font-size: 30px;
}
td{
  font-size: 25px;
}
.big-button{
  font-size: 30px;
}
body{
  font-size: 20px;
}
p {
    font-size: 30px;     
    line-height: 1.3rem;   
}


@media screen and (max-width: 992px) {
  body {
    color: black;
    
  }


.big-button{
  font-size: 25px;
}

}
@media screen and (max-width: 350px) {

  *{
    margin: 0px;
    padding: 0px;
    box-sizing: border-box;
    
  }
  body {
    width:98vw;
    font-size: 40px;

    
  }
  table{
  height: 100%;
  max-width: 9vw;
}
th{
  font-size: 20px;
}
  h1 {
    font-size: 20px;
  }
  .big-button{
  font-size: 20px;
}
}
</style>

<body>
  <%  Commodityid = commodities[0].id %>
  <% commodityName = commodities[0].name %>
  <% commodities = commodities[0].commodities %>
  <% message = message %>
  <% let serialNumber = 1 %>


  <span id="id" style="font-size:0px;"><%=Commodityid%></span>
  <h1 class="h1 text-center"> LAST UPDATED COMMODITY VS PRICE FOR KASUWA FARMS</h1>

  <h1 id="message"><% message %></h1>

  <table class="table table-bordered table-hover table-dark" >
    <thead class="thead-dark table-hover thead-dark">
      <tr>
        <th scope="col" >S/N</th>
        <th scope="col" >COMMODITY NAME</th>
        <th scope="col" >PRICE</th>
        <th scope="col" class="text-center">DELETE</th>
      </tr>
    </thead>

    <% if(commodities.length > 0){  %>

    <tbody>

        <% commodities.forEach(commod=>{ %>

        <tr class="commod_block" scope="row">
          <th scope="row"><%=serialNumber++ %></th>
          <td class="commod text-capitalize"><%= commod.name %></td>
          <td class="price" data-price="<%= commod.name %>" contenteditable><%= commod.price %></td>
          <td class="text-center"><a role="button" class="btn btn-danger delete" data-doc="<%= commod.name %>" id="<%= commod.id %>" >DELETE</a>
          </td>
        </tr>

        <% }) %>
    </tbody>

    <% } else { %>

    <p>no commodity to display</p>
    <% } %>

  </table>


  <% var comm_odities = commodities; %>

  <div class="text-center"><a href="/admin/addcommodity" class="btn btn-primary big-button" href="#" role="button">ADD COMMODITY</a> <a id="update" role="button"class="btn btn-success big-button">UPDATE</a>
  </div>
  <SCript>
    let message = document.getElementById("message");



    const deletebtns = Array.from(document.getElementsByClassName('delete'))

    const commodBlock = Array.from(document.getElementsByClassName("commod_block"));
    const commodities = Array.from(document.getElementsByClassName("commod"));
    const price = Array.from(document.getElementsByClassName("price"));
    const upDate = document.getElementById("update")
    let Document_id = document.getElementById("id").innerText

    let box = []



    deletebtns.forEach(deletebtn => {
      deletebtn.addEventListener("click", () => {
        if (confirm('are you sure you want to delete item?')==true){
          let id = deletebtn.id
        console.log(deletebtn.id)
        console.log(deletebtn.dataset.doc)
        fetch(`/admin/delete:${Document_id}/commodities/:${id}`, {
            method: 'DELETE'
          })
          .then(response => response.json())
          .then(response => {
            alert("item deleted successful")
            location.reload()
          })
        }
        else{
          alert("delete cancelled")
        }
      
          // location.reload()
      })
    })

    upDate.addEventListener("click", () => {
      
    if (confirm('Are you sure you want to update all prices?')==true){
      commodBlock.forEach((commod) => {
        let name = commod.querySelector(".commod").textContent
        let price = commod.querySelector(".price").textContent
        box.push({
          name: name,
          price: price
        })

      })

      fetch('/admin/updateAll', {
          method: 'POST',
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            commodities: box
          })
        })
        .then(response => response.json())
        .then(response => {
          console.log(JSON.stringify(response))
          alert(`last database update successful`)
          location.reload()
        })
    }
    else{
      location.reload()
      alert("delete canceled")
    }
      
    })
  </SCript>


</body>


</html>